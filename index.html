<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/images/Pokemon-Logo.jpg" type="image/x-icon">
  <title>PokÃ©mon TV â€“ Live</title>
  
  <style>
    :root {
      --bg: #0a101e;
      --card: #161d2fcc;
      --border: #232d45;
      --pokemon-yellow: #ffcb05; /* Classic Pikachu Yellow */
      --pokemon-blue: #3d7dca;   /* PokÃ©mon Blue */
      --text: #f5f5f4;
      --muted: #94a3b8;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      display: block; /* Overriding your previous flex-center for the new layout */
      height: auto;
    }

    .container {
      max-width: 1100px;
      margin: auto;
      padding: 2rem 1rem;
    }

    .back {
      text-decoration: none;
      color: var(--muted);
      font-size: 1.5rem;
      margin-bottom: 1rem;
      display: inline-block;
    }

    /* Modern Card Layout */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 1.5rem;
      padding: 1.5rem;
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      backdrop-filter: blur(10px);
    }

    .poster {
      width: 240px;
      height: 240px;
      border-radius: 1rem;
      overflow: hidden;
      border: 2px solid rgba(255, 203, 5, 0.3);
      box-shadow: 0 0 30px rgba(61, 125, 202, 0.15);
      background: #000;
    }

    .poster img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 1rem;
    }

    .info {
      flex: 1;
      min-width: 280px;
    }

    .title {
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 900;
      color: var(--pokemon-yellow);
      text-transform: uppercase;
      letter-spacing: -1px;
    }

    .genre {
      color: var(--muted);
      margin-top: .25rem;
      font-weight: 500;
    }

    .plot {
      margin-top: 1rem;
      padding: 1rem;
      border-left: 4px solid var(--pokemon-blue);
      background: rgba(35, 45, 69, 0.5);
      border-radius: 0 0.75rem 0.75rem 0;
      line-height: 1.5;
    }

    .meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: .75rem;
      margin-top: 1.5rem;
    }

    .meta div {
      background: rgba(15, 23, 42, 0.6);
      padding: .75rem;
      border-radius: .75rem;
      border: 1px solid var(--border);
    }

    .meta small {
      color: var(--muted);
      text-transform: uppercase;
      font-size: 0.7rem;
      letter-spacing: 1px;
    }

    /* Video Player Styling */
    .video-wrap {
      margin-top: 2rem;
      position: relative;
      border-radius: 1.5rem;
      overflow: hidden;
      border: 1px solid var(--border);
      box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    }

    video {
      width: 100%;
      display: block;
      background: #000;
    }

    .player-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: #0f172a;
      border-top: 1px solid var(--border);
    }

    select, #unmuteBtn {
      background: #1e293b;
      color: #fff;
      border: 1px solid var(--border);
      padding: 0.6rem 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    #unmuteBtn {
      background: var(--pokemon-blue);
      border: none;
      font-weight: bold;
    }

    #unmuteBtn:hover {
      filter: brightness(1.2);
    }

    /* Guide Section */
    .instructions {
      margin-top: 2rem;
      padding: 1.5rem;
      background: rgba(30, 41, 59, 0.4);
      border-radius: 1rem;
      border: 1px dashed var(--border);
    }

    .instructions h4 {
      margin: 0 0 10px 0;
      color: var(--pokemon-blue);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .instructions ul {
      margin: 0;
      padding-left: 1.2rem;
      color: var(--muted);
      column-count: 2;
    }

    @media (max-width: 600px) {
      .poster { width: 100%; height: auto; }
      .instructions ul { column-count: 1; }
    }

.back {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 42px;
  height: 42px;
  text-decoration: none;
  background: #fbbf24;
  color: black;
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  font-size: 1.2rem;
  transition: all 0.2s ease;
  backdrop-filter: blur(8px);
}

.back:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: #fbbf24; /* Or your theme color */
  color: #fbbf24;
  transform: translateX(-3px);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}
  </style>
</head>
<body>

  <div class="container">
    <a href="https://giveth-station.vercel.app/tv" title="Back to Tv Page" class="back">&larr;</a>
    <div class="card">
      <div class="poster">
        <img src="/images/Pokemon-Logo.jpg" alt="PokÃ©mon TV">
      </div>

      <div class="info">
        <div class="title">PokÃ©mon TV</div>
        <div class="genre">Adventure â€¢ Action â€¢ Fantasy</div>

        <div class="plot">
          Catch 'em all with 24/7 non-stop PokÃ©mon episodes. Follow Ash and Pikachu on their legendary journey across every region.
        </div>

        <div class="meta">
          <div><small>Quality</small><br><b>Full HD</b></div>
          <div><small>Status</small><br><b style="color:#4ade80">LIVE</b></div>
          <div><small>Category</small><br><b>Classic</b></div>
          <div><small>Audio</small><br><b>English</b></div>
        </div>
      </div>
    </div>

    <div class="video-wrap">
      <video id="video" controls autoplay muted playsinline></video>
      
      <div class="player-controls">
        <label style="font-size: 14px; color: var(--muted);">
          Quality: 
          <select id="qualitySelect">
            <option value="auto">Auto</option>
          </select>
        </label>
        
        <button id="unmuteBtn">ðŸ”ˆ Unmute</button>
      </div>
    </div>

    <div class="instructions">
      <h4>ðŸ“º Trainer's Guide</h4>
      <ul>
        <li><b>Audio:</b> Click <b>Unmute</b> to hear the action.</li>
        <li><b>Sync:</b> Feeds auto-refresh if a lag occurs.</li>
        <li><b>Quality:</b> Switch to 480p if buffering.</li>
        <li><b>Live:</b> This is a 24/7 programmed stream.</li>
      </ul>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
      const video = document.getElementById("video");
      const qualitySelect = document.getElementById("qualitySelect");
      const API_BASE = window.location.origin;

      const originalUrl = "https://cfd-v4-service-channel-stitcher-use1-1.prd.pluto.tv/stitch/hls/channel/6675c7868768aa0008d7f1c7/master.m3u8?terminate=false&appName=web&appVersion=unknown&clientTime=0&deviceDNT=0&deviceId=d3595b5a-7553-4a6b-b9dd-c30951631395&deviceMake=Chrome&deviceModel=web&deviceType=web&deviceVersion=unknown&includeExtendedEvents=false&serverSideAds=false&sid=bc32713f-dc5f-45d9-8650-2b4e69506b23";
      const hlsUrl = `${API_BASE}/proxy?url=${encodeURIComponent(originalUrl)}`;

      let hls;

      // --- THE NUCLEAR OPTION (Clears all browser memory for this site) ---
      async function nukeAndReload() {
          console.warn("ðŸš€ 10s STALL: Performing Full Data Nuke & Reload...");
          
          // 1. Clear Standard Storage
          localStorage.clear();
          sessionStorage.clear();

          // 2. Clear All Cookies
          const cookies = document.cookie.split(";");
          for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i];
              const eqPos = cookie.indexOf("=");
              const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
              document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
          }

          // 3. Clear Cache Storage (The most important part for HLS)
          if ('caches' in window) {
              const cacheNames = await caches.keys();
              await Promise.all(cacheNames.map(name => caches.delete(name)));
          }

          // 4. Clear IndexedDB
          if (window.indexedDB && window.indexedDB.databases) {
              const dbs = await window.indexedDB.databases();
              dbs.forEach(db => window.indexedDB.deleteDatabase(db.name));
          }

          // 5. Final Reload
          window.location.reload();
      }

      // --- INTERNAL NUDGE (Stage 1 Recovery) ---
      function forceRecover() {
          console.warn("ðŸ› ï¸ Stage 1: Flushing buffer and nudging playhead...");
          const currentTime = video.currentTime;
          hls.stopLoad(); 
          video.currentTime = currentTime + 0.1;
          hls.startLoad();
      }

      if (Hls.isSupported()) {
          hls = new Hls({
              liveSyncDurationCount: 3,
              maxStarvationDelay: 1,
              nudgeOffset: 0.1,
              nudgeMaxRetry: 5,
              enableWorker: true,
              lowLatencyMode: true
          });

          hls.loadSource(hlsUrl);
          hls.attachMedia(video);

          hls.on(Hls.Events.MANIFEST_PARSED, (event, data) => {
              qualitySelect.innerHTML = '<option value="auto">Auto</option>';
              hls.levels.forEach((level, index) => {
                  let opt = document.createElement("option");
                  opt.value = index;
                  opt.textContent = level.height ? `${level.height}p` : `Level ${index}`;
                  qualitySelect.appendChild(opt);
              });
          });

          hls.on(Hls.Events.ERROR, (event, data) => {
              if (data.fatal) {
                  if (data.type === Hls.ErrorTypes.NETWORK_ERROR) hls.startLoad();
                  else if (data.type === Hls.ErrorTypes.MEDIA_ERROR) hls.recoverMediaError();
                  else nukeAndReload(); // Fatal unknown error triggers the nuke
              }
          });

          qualitySelect.addEventListener("change", () => {
              const value = qualitySelect.value;
              hls.currentLevel = (value === "auto") ? -1 : parseInt(value);
          });

      } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
          video.src = hlsUrl;
      }

      // Unmute Button Logic
      const unmuteBtn = document.getElementById("unmuteBtn");
      unmuteBtn.addEventListener("click", () => {
          video.muted = !video.muted;
          unmuteBtn.textContent = video.muted ? "ðŸ”ˆ Unmute" : "ðŸ”Š Mute";
      });

      // --- AGGRESSIVE HEARTBEAT ---
      let lastTime = -1;
      let stuckCounter = 0;

      setInterval(() => {
          if (hls && !video.paused && video.readyState >= 2) {
              const currentPos = video.currentTime;

              // 1. Detect Stalling
              if (lastTime > 0 && Math.abs(currentPos - lastTime) < 0.2) {
                  stuckCounter++;
                  console.warn(`ðŸ¢ Stall Counter: ${stuckCounter}/10`);
              } else {
                  stuckCounter = 0;
              }

              // 2. Loop Detection
              if (lastTime > 0 && currentPos < lastTime - 0.5) {
                  console.error("ðŸ”„ Loop detected!");
                  nukeAndReload();
                  return;
              }

              // 3. Multi-Stage Recovery
              if (stuckCounter === 5) {
                  // First try the light nudge
                  forceRecover();
              } 
              else if (stuckCounter >= 10) {
                  // If still stuck 5 seconds after the nudge, nuke the storage
                  nukeAndReload();
              }

              lastTime = currentPos;
          }
      }, 1000);
  </script>

</body>
</html>